コードの主な処理フロー
画像の読み込みと前処理

画像を読み込み、コントラストを強調したりノイズを除去します。
楕円の検出

輪郭を抽出して、楕円をフィッティングします。
楕円の真円変換

楕円の軸に基づきスケールを計算し、アフィン変換で真円に補正します。
結果の保存

元画像、検出された楕円の可視化結果、変換後の画像をそれぞれ表示し、結果を保存します。
関数の詳細
1. detect_ellipse(image)
楕円を検出するための関数。

入力: 画像（image）
出力: 楕円の中心座標、軸の長さ（長軸・短軸）、回転角度
処理手順
グレースケール変換
RGB画像を1チャンネルのグレースケール画像に変換。

コントラスト強調
CLAHE (Contrast Limited Adaptive Histogram Equalization) を用いて画像のコントラストを向上。

ノイズ除去
ガウシアンフィルタを適用。

2値化とモルフォロジー処理

画像を閾値で2値化。
モルフォロジー処理（閉じる・開く操作）で小さなノイズを除去。
輪郭検出

cv2.findContours を使って輪郭を取得。
面積が最大の輪郭を選択。
楕円フィッティング

点数が5以上の輪郭に対して cv2.fitEllipse を適用し、楕円をフィッティング。
2. ellipse_to_circle(image)
検出した楕円を真円に補正する関数。

入力: 画像（image）
出力: 真円に補正された画像、検出結果の可視化画像、楕円の情報（中心、軸、角度）
処理手順
楕円検出

detect_ellipse を呼び出し、楕円の情報を取得。
スケール計算

楕円の長軸・短軸から短軸に基づいたスケールを計算（短軸に合わせて楕円を真円化）。
アフィン変換行列作成

回転行列を取得し、スケールを反映した変換行列を作成。
変換適用

cv2.warpAffine を使って画像を変換。
3. draw_detected_shapes(image, center, axes, angle)
検出された楕円や中心を画像上に描画する関数。

入力: 画像（image）、楕円の情報（center、axes、angle）
出力: 描画済み画像
4. main()
メイン関数。

入力画像を読み込み、楕円検出と真円補正を実行。
結果を表示・保存。
注意点
入力画像

明瞭な楕円形状が写った画像が適しています。ノイズや他の形状が多い場合、検出精度が低下する可能性があります。
スケール計算

現在は短軸に基づいてスケールを計算していますが、用途に応じて変更が必要かもしれません。
アフィン変換行列

スケールの適用において、変換行列が正しく設定されているか確認が必要です。
デバッグ用表示

中間処理結果を確認するために、適宜表示や保存を活用してください。
